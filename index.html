<!DOCTYPE html>
<html lang="cs">
<head>
<meta charset="UTF-8">
<title>ğŸ¤‘ SleviÄky</title>
<link rel="canonical" href="https://slevicky.pages.dev/">
<link rel="dns-prefetch" href="https://cdn.jsdelivr.net">
<link rel="preconnect" href="https://cdn.jsdelivr.net">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="referrer" content="no-referrer-when-downgrade">
<meta name="description" content="AktuÃ¡lnÃ­ slevy potravin a akÄnÃ­ zboÅ¾Ã­ pÅ™ehlednÄ› na jednom mÃ­stÄ›. (public alfa)">
<meta property="og:description" content="AktuÃ¡lnÃ­ slevy potravin a akÄnÃ­ zboÅ¾Ã­ pÅ™ehlednÄ› na jednom mÃ­stÄ›. (public alfa)">
<meta name="theme-color" content="#fff">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black">
<meta name="apple-mobile-web-app-title" content="ğŸ¤‘ SleviÄky">
<meta name="mobile-web-app-capable" content="yes">
<meta name="google" content="notranslate">
<meta name="format-detection" content="address=no">
<meta name="format-detection" content="date=no">
<meta name="format-detection" content="email=no">
<meta name="format-detection" content="telephone=no">
<meta property="og:locale" content="cs_CZ">
<meta property="og:type" content="website">
<meta property="og:title" content="ğŸ¤‘ SleviÄky">
<meta property="og:image" content="/og-image.webp">
<link rel="apple-touch-startup-image" href="/logo.webp" type="image/webp">
<link rel="apple-touch-icon" href="/favicon-152.webp" type="image/webp" sizes="152x152">
<link rel="apple-touch-icon" href="/favicon-167.webp" type="image/webp" sizes="167x167">
<link rel="apple-touch-icon" href="/favicon-180.webp" type="image/webp" sizes="180x180">
<link rel="icon" type="image/webp" href="/favicon-256.webp" sizes="256x256">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/beercss/beercss@v3.13.1/dist/cdn/beer.min.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/material-icons@1.13.14/iconfont/material-icons.min.css">
<link rel="manifest" href="/manifest.json">
<script src="/jquery.min.js"></script>
<style>
/* VARIABLES */
:root {
    --market-image-height: 48px;
    --on-surface-light: #2c2c2c;
    --product-image-height: 100px;
    --surface-container-high-light: #e0e0e0;
    --surface-container-highest-light: #d4d4d4;
    --surface-container-light: #ececec;
    --surface-container-low-light: #f5f5f5;
}

body {min-width: 320px;}
a {text-decoration: underline;color: black;}
hr {border: none;height: 4px;width: 50%;background: linear-gradient(to right, black, transparent);margin-bottom: 1rem;}

#deals {content-visibility: auto;}

/* LOADING */
#loading {
    filter: blur(0px);
    will-change: filter, opacity;
    transition: opacity 1s ease-out, filter 1s ease-out, visibility 1s ease-out;
}
#loading.fade-away {
    opacity: 0 !important;
    filter: blur(50px) !important;
    visibility: hidden !important;
}

/* DEBUGGER */
#debugger {width: 75%;opacity: 0.85;position: fixed;top: 70px;left: 0;z-index: 100;max-height: 300px;overflow-y: auto;display: flex;flex-direction: column-reverse;}
.debugger-on {padding: 10px;transition: all 0.3s ease;}

/* PROGRESS BAR */
.progress-container {
    position: fixed;
    top: 0;
    left: 0;
    height: 4px;
    width: 100%;
    background-color: #000;
    z-index: 9999;
}

.progress-bar {
    height: 4px;
    background: linear-gradient(to right, #004, #aaa, #0af);
    box-shadow: 0 0 8px rgba(255, 0, 0, 0.6);
    transition: width 0.2s ease;
}

/* PWA installer */
.install-btn {z-index: 100;}

/* ABOUT */
#about ul {list-style-type: none;padding: 0;margin: 0;}
#about li {padding: 4px 0;}

/* HELPERS */
.bigger {font-size: 2rem;font-weight: bold;}
.hover {cursor: pointer;}
.mono {font-family: monospace;}
.noselect {-webkit-user-select: none;-ms-user-select: none;user-select:none;}
.notap {cursor: pointer;-webkit-tap-highlight-color: transparent;-moz-tap-highlight-color: transparent;-ms-tap-highlight-color: transparent;}
.nowrap {white-space: nowrap !important;overflow: hidden;text-overflow: ellipsis;}
.hidden {display: none;}

/* VFX bombs */
.flashbomb {animation: flash 0.5s ease-out;}
.facespinner {display: inline-block;animation: spin 1s cubic-bezier(0.15, 0, 0.15, 1) forwards;}
@keyframes spin {
    from { transform: rotate(0deg); }
    to { transform: rotate(1800deg); } /* 5 plnÃ½ch otoÄek */
}
@keyframes flash {
    0% { opacity: 0; }
    100% { opacity: 1; }
}

/* NAVIGATION quirks */
.grayscaled {filter: grayscale(100%);opacity: 0.5;}

/* defaults */
.slevicky {display: none;}
.topnavtxt {display: none;}

/* vylepÅ¡enÃ­ pozicovÃ¡nÃ­ */
.downer {position: relative;top: 5px;}

/* BUTTONS */
.billionaire {padding: 1rem;}

.btn-top {
    font-size: 1rem;
    background-color: 0 !important;
    color: white !important;
    border: 1px solid #000 !important;
    border-radius: 0!important;
    padding: 5px;
}

.btn-bottom {
    font-size: 1rem;
    background-color: 0 !important;
    color: white !important;
    border: 1px solid #000 !important;
    border-radius: 0!important;
    padding: 5px;
}

/* remove hover color on top NAV buttons */
nav.top button::before, nav.top button::after {background: none !important;}

/* default NAV buttons letter-spacing */
nav.bottom button {letter-spacing: 0;}

#about, #settings {
    width: 95%;
    margin: 0 auto;
    margin-top: 2rem;
    text-align: left;
}

/* settings switch */
.settings-button {margin-top: 20px;max-width: 300px;}

/* DEALS */
#deals {
    display: grid;
    gap: 5px;
    grid-template-columns: repeat(2, 1fr); /* mobil: 2 sloupce */
    width: 100%;
}

/* CARD flexible */
.product-card {
    display: flex;
    justify-content: space-between;
    flex-direction: column;
    height: 100%;
    margin: 0 !important;
    padding: 5px;
    overflow: hidden;
    background: white;
}

/* MARKET image */
.market-image {
    display: inline-block;
    width: auto;
    height: var(--market-image-height);
    object-fit: contain;
    margin: 0 auto;
    border-radius: 0 !important;
    padding-bottom: 10px;
}

/* PRODUCT image */
.product-image {
    display: block;
    width: 100%;
    height: var(--product-image-height); /* fixnÃ­ vÃ½Å¡ka pro srovnÃ¡nÃ­ Å™Ã¡dkÅ¯ */
    object-fit: contain; /* obrÃ¡zek se nebude deformovat */
    margin: 5px 0;
    border-radius: 3px !important;
}

.image-wrapper {
    height: var(--product-image-height);
    display: flex;
    align-items: center;
    justify-content: center;
}

.product-name {
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
    font-size: 1rem;
    line-height: 1.2rem;
    text-align: center;
    border-radius: 0 !important;
    padding-top: 10px;
}

.product-note {
    display: -webkit-box;
    -webkit-line-clamp: 3;
    -webkit-box-orient: vertical;
    overflow: hidden;
    font-style: italic;
    text-align: center;
    font-size: 0.85rem;
    line-height: 1rem;
    border-radius: 0 !important;
    margin-top: 10px;
}

.product-price {
    display: flex;
    flex-direction: column;
    align-items: center;
    margin-top: auto;
}

.discount {
    font-size: 1.3rem;
    font-weight: bold;
    color: white;
    background-color: red;
    padding: 5px;
    margin: 0 auto;
    margin-top: 10px;
    margin-bottom: 10px;
    border-radius: 3px;
}

.discount:empty {
    display: none;
}

.price {
    font-size: 1.2rem;
    font-weight: bold;
    color: var(--primary);
}

.validity {
    display: flex;
    flex-direction: column;
    align-items: center;
    font-size: 0.75rem;
    color: #fff;
    background-color: green;
    margin-top: 5px;
    margin-bottom: 5px;
    border-radius: 0;
    border-bottom-left-radius: 8px !important;
    border-bottom-right-radius: 8px !important;
    position: relative;
    top: 5px;
}

.volume {font-size: 0.7rem;font-weight: bold;}
.ppunit {font-size: 0.8rem;color: #000;opacity: 0.6;}

/* MEDIA selectors */
@media(min-width: 500px) {
    #deals {
        grid-template-columns: repeat(4, 1fr); /* tablet: 4 sloupcÅ¯ */
    }
    .btn-bottom {font-size: 1.3rem;}
    .price {font-size: 1rem;}
    nav.bottom button {letter-spacing: 0.3rem;}
    #about, #settings {width: 90%;margin-top: 1rem;}
    #debugger {width: 90%}
}
@media(min-width: 700px) {
    #deals {
        grid-template-columns: repeat(6, 1fr); /* tablet: 6 sloupcÅ¯ */
    }
    .btn-bottom {font-size: 1.7rem;}
    .slevicky {display: inline-block;font-size: 1.3rem;font-weight: bold;}
    .topnavtxt {display: inline-block;}
    .price {font-size: 0.8rem;}
    nav.bottom button {letter-spacing: 0.5rem;}
    #about, #settings {width: 80%;margin-top: 1rem;}
    #debugger {width: 80%}
}
@media(min-width: 1270px) {
    #deals {
        grid-template-columns: repeat(8, 1fr); /* desktop: 8 sloupcÅ¯ */
    }
    .btn-bottom {font-size: 1.9rem;}
    .slevicky {display: inline-block;font-size: 1.5rem;font-weight: bold;}
    .topnavtxt {display: inline-block;}
    .price {font-size: 1.1rem;}
    nav.bottom button {letter-spacing: 0.7rem;}
    #about, #settings {width: 70%;margin-top: 1rem;}
    #debugger {width: 50%}
}
@media(min-width: 1800px) {
    #deals {
        grid-template-columns: repeat(10, 1fr); /* desktop: 10 sloupcÅ¯ */
    }
    .btn-bottom {font-size: 2.1rem;}
    .topnavtxt {display: inline-block;}
    .price {font-size: 1.2rem;}
    nav.bottom button {letter-spacing: 1rem;}
    #about, #settings {width: 50%;margin-top: 1rem;}
    #debugger {width: 30%}
}

article.hidden-force {
    display: none !important;
}

/* bottom NAV separators */
nav.bottom > button:not(:last-child) {
  border-right: none !important;
  background-image: linear-gradient(to bottom, 
    transparent 10%,
    #444 10%,
    #888 70%,
    #444 25%,
    #000 100%
  );
  background-position: center right;
  background-size: 2px 100%;
  background-repeat: no-repeat;
}
  
nav.bottom button {
    flex: 1;
    display: flex;
    justify-content: center;
    align-items: center;
}
</style>
</head>
<body class="light">

<!-- TOP navigation - righthanded -->
<nav class="righthanded top notap nowrap black white-text">
    <button class="install-btn light-blue" style="display: none;">
        <span>Instalovat â™¥ï¸</span>
    </button>
    <div class="max noselect">
        <span class="billionaire">
            <span class="dollarface bigger">ğŸ¤‘</span>&nbsp;&nbsp;<span class="slevicky bold">SleviÄky</span>
        </span>
    </div>
    <button data-id="about" class="about-btn transparent white-text">
        <i>info</i>
        <span class="topnavtxt downer">Info</span>
    </button>
    <button data-id="settings" class="settings-btn transparent white-text">
        <i>settings</i>
        <span class="topnavtxt downer">NastavenÃ­</span>
    </button>
    <button data-id="refresh" class="refresh-btn transparent white-text">
        <i class="bigger">refresh</i>
    </button>
</nav>

<!-- TOP navigation - lefthanded -->
<nav class="lefthanded top notap nowrap black white-text" style="display: none;">
    <button data-id="refresh" class="refresh-btn transparent white-text">
        <i>refresh</i>
    </button>
    <button data-id="settings" class="settings-btn transparent white-text">
        <i>settings</i>
        <span class="topnavtxt downer">NastavenÃ­</span>
    </button>
    <button data-id="about" class="about-btn transparent white-text">
        <i>info</i>
        <span class="topnavtxt downer">Info</span>
    </button>
    <div class="max noselect">
        <span class="billionaire">
            <span class="dollarface bigger">ğŸ¤‘</span>&nbsp;&nbsp;<span class="slevicky bold">SleviÄky</span>
        </span>
    </div>
    <button class="install-btn light-blue" style="display: none;">
        <span>Instalovat â™¥ï¸</span>
    </button>
</nav>

<!-- BOTTOM navigation - lefthanded -->
<nav class="righthanded bottom notap black white-text grid no-space" style="display: grid; grid-template-columns: repeat(5, 1fr); height: auto;">
    <button title="NÃPOJE - CUKROVINKY - OSTATNÃ" data-cats=".c-NÃPOJE, .c-CUKROVINKY, .c-OSTATNÃ" class="but5 nowrap btn-bottom black white-text bold s1">ğŸ·ğŸ¬ğŸ“¦</button>
    <button title="MASO - UZENINY - TUKY" data-cats=".c-MASO, .c-UZENINY, .c-TUKY" class="but4 nowrap btn-bottom black white-text bold s1">ğŸ¥©ğŸ¥“ğŸ§ˆ</button>
    <button title="OBILOVINY - LUÅ TÄšNINY - KOÅ˜ENÃ" data-cats=".c-OBILÃ, .c-LUÅ TÄšNINY, .c-KOÅ˜ENÃ" class="but3 nowrap btn-bottom black white-text bold s1">ğŸŒ¾ğŸ«˜ğŸŒ¶ï¸</button>
    <button title="MLÃ‰KO - SÃRY - VEJCE" data-cats=".c-MLÃ‰KO, .c-SÃRY, .c-VEJCE" class="but2 nowrap btn-bottom black white-text bold s1">ğŸ¥›ğŸ§€ğŸ¥š</button>
    <button title="ZELENINA - OVOCE - OÅ˜ECHY" data-cats=".c-ZELENINA, .c-OVOCE, .c-OÅ˜ECHY" class="but1 nowrap btn-bottom black white-text bold s1">ğŸ¥¦ğŸğŸ¥œ</button>
</nav>

<!-- BOTTOM navigation - righthanded -->
<nav class="lefthanded bottom notap black white-text grid no-space" style="display: none; grid-template-columns: repeat(5, 1fr); height: auto;">
    <button title="ZELENINA - OVOCE - OÅ˜ECHY" data-cats=".c-ZELENINA, .c-OVOCE, .c-OÅ˜ECHY" class="but1 nowrap btn-bottom black white-text bold s1">ğŸ¥¦ğŸğŸ¥œ</button>
    <button title="MLÃ‰KO - SÃRY - VEJCE" data-cats=".c-MLÃ‰KO, .c-SÃRY, .c-VEJCE" class="but2 nowrap btn-bottom black white-text bold s1">ğŸ¥›ğŸ§€ğŸ¥š</button>
    <button title="OBILOVINY - LUÅ TÄšNINY - KOÅ˜ENÃ" data-cats=".c-OBILÃ, .c-LUÅ TÄšNINY, .c-KOÅ˜ENÃ" class="but3 nowrap btn-bottom black white-text bold s1">ğŸŒ¾ğŸ«˜ğŸŒ¶ï¸</button>
    <button title="MASO - UZENINY - TUKY" data-cats=".c-MASO, .c-UZENINY, .c-TUKY" class="but4 nowrap btn-bottom black white-text bold s1">ğŸ¥©ğŸ¥“ğŸ§ˆ</button>
    <button title="NÃPOJE - CUKROVINKY - OSTATNÃ" data-cats=".c-NÃPOJE, .c-CUKROVINKY, .c-OSTATNÃ" class="but5 nowrap btn-bottom black white-text bold s1">ğŸ·ğŸ¬ğŸ“¦</button>
</nav>

<!-- debugger -->
<div id="debugger" class="notap noselect blue-grey black-text bold debugger"></div>

<!-- CONTENT -->
<main class="container">
    <noscript>
        <div style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: flex; align-items: center; justify-content: center; background: white; z-index: 9999; text-align: center; padding: 20px;">
            <h3>
                Tahle appka je zcela zÃ¡vislÃ¡ na pouÅ¾itÃ­ JavaScriptu ğŸ˜ï¸
                <br><br>
                Bez nÄ›j to prostÄ› nepÅ¯jde ...
            </h3>
        </div>
    </noscript>
    <div id="loading" style="position: fixed; top: 0; left: 0; width: 100%; height: 100%; display: none; align-items: center; justify-content: center; background: white; z-index: 9999; text-align: center; padding: 20px;">
        <h2 id="loading-info" style="color: black;">
            ğŸ‘©â€ğŸ”§ NahrÃ¡vÃ¡m ...
        </h2>
    </div>
    <div id="deals"></div>
    <div id="about" class="hidden">
        <h3>Statistika</h3><hr>
        <div id="stats"></div>

        <h3>Aplikace</h3><hr>
        ğŸ‘¾ build: <b>{{GIT_REV}}</b><br>
        ğŸ‘©â€ğŸ”§ revision: <b>{{COUNT_REV}}</b><br>
        ğŸ“… date: <b>{{DATE_REV}}</b><br>
        Backend je napsÃ¡n v Golang, frontend HTML5, CSS3, JavaScript, jQuery + Beercss framework.<br>

        <h4>Changelog</h4><hr>
        <ul>
            <li><b>2026-01-09</b>
                <br>â—¾ï¸ vylepÅ¡enÃ© UI, pevnÃ© mezery, tÅ™Ã­dÄ›nÃ­ obchodÅ¯
                <br>â—¾ï¸ notifikace novÃ© verze
            </li>
            <li><b>2026-01-08</b>
                <br>â—¾ï¸ zÃ¡kladnÃ­ UI
                <br>â—¾ï¸ filtrovÃ¡nÃ­ dle kategoriÃ­
                <br>â—¾ï¸ data shuffle pÅ™es ğŸ¤‘
            </li>
        </ul>

        <h4>PodnÄ›ty, myÅ¡lenky, crazy&nbsp;stuff</h4><hr>
        <h5>
            <i>link</i>
            ğŸ’¡ <a href="https://docs.google.com/forms/d/e/1FAIpQLSeDAro5rHG_Mj2rRra3oqaWUgCVfn1asFtI3z_pgfqcrL85qg/viewform?usp=dialog">mÃ¡Å¡ nÃ¡pad? napiÅ¡ ho sem!</a>
        </h5><br>

        <h4>Pod kapotou</h4><hr>
        local storage: <span id="info_localStorage" class="bold"></span><br>
    </div>
    <div id="settings" class="hidden container">
        <h3>Moje obchody</h3><hr>
        <div id="mymarkets"></div>

        <h3>Moje kategorie</h3><hr>
        <div id="mycats"></div>

        <h3>BlokovanÃ© zboÅ¾Ã­</h3><hr>
        <div id="blocked"></div>

        <h3>NastavenÃ­</h3><hr>
        <button class="blue settings-button">ğŸ‘ï¸ levÃ¡k &ndash; pravÃ¡k</button><br>
        <div id="saveload">
            <button id="save" class="green settings-button">save</button>
            <button id="load" class="green settings-button" disabled>load</button>
        </div>
    </div>
</main>

<script>
'use strict';

// enable splash screen
document.getElementById('loading').style.display = 'flex';

/* DEALS object */
window.deals = {};
deals.blocked = [];
deals.likes = [];
deals.myCats = [];
deals.myMarkets = [];

// SHUFFLE prototype
if (!Array.prototype.shuffle) {
    Array.prototype.shuffle = function() {
        for (let i = this.length - 1; i > 0; i--) {
            const j = Math.floor(Math.random() * (i + 1));
            [this[i], this[j]] = [this[j], this[i]];
        }
        return this;
    };
}

// DEBUGGER
var dtimer = null;
function debug(x) {
    if (!x) return;
    const now = new Date();
    const ts = now.getHours().toString().padStart(2, '0')
        + ':' + now.getMinutes().toString().padStart(2, '0')
        + ':' + now.getSeconds().toString().padStart(2, '0')
        + '.' + now.getMilliseconds().toString().padStart(3, '0');
    $('#debugger').append('[' + ts + '] ' + x + '<br>').addClass('debugger-on').fadeIn();
    if (dtimer) clearTimeout(dtimer);
    dtimer = setTimeout(function() {
        dtimer = null;
        $('#debugger').fadeOut(function() {
            $('#debugger').html('').removeClass('debugger-on');
        });
    }, 5000);
}
window.debug = debug;

// UUID
var uuid = null;
try {
  uuid = crypto.randomUUID();
} catch (e) {
  uuid = ([1e7]+-1e3+-4e3+-8e3+-1e11).replace(/[018]/g,
      c => (c ^ crypto.getRandomValues(new Uint8Array(1))[0] & 15 >> c / 4).toString(16)
  );
}

// LOCAL STORAGE test
let nolocalstorage = false;
try {
    const storage = window.localStorage;
    const testKey = '__storage_test__';
    storage.setItem(testKey, testKey);
    storage.removeItem(testKey);
    if (!storage.getItem('uuid') || storage.getItem('uuid').length !== 36) {
        storage.setItem('uuid', uuid);
    }
    storage.removeItem('luid'); // Cleanup starÃ©ho bordelu
} catch (e) {
    nolocalstorage = true;
    console.warn('SleviÄky: localStorage je blokovÃ¡n (pravdÄ›podobnÄ› anonymnÃ­ reÅ¾im)');
}
window.nolocalstorage = nolocalstorage;
$('#info_localStorage').text(!nolocalstorage ? "OK" : "BLOKOVÃNO");
if (nolocalstorage) {
    $('#saveload').hide();
    $('#load').prop('disabled', true);
    $('#save').prop('disabled', true);
}

// BUILD info
const version = '{{GIT_REV}}';
const git_build_date = '{{DATE_REV}}';
const git_revisions = '{{COUNT_REV}}';

// check for updates on Cloudflare Pages
function checkUpdate() {
    if (version === '{{' + 'GIT_REV' + '}}') return;
    const updateTimer = setInterval(() => {
        $.getJSON('/meta.json?t=' + new Date().getTime(), function(data) {
            if (data && data.version && data.version !== version) {
                debug('ZjiÅ¡tÄ›na novÃ¡ verze: ' + data.version);
                console.log('ZjiÅ¡tÄ›na novÃ¡ verze: ' + data.version + ' vs ' + version);
                $('.refresh-btn').append('<badge class="bold">!</badge>').addClass('red-text');
                clearInterval(updateTimer);
            }
        }).fail(function() {
            console.warn('NepodaÅ™ilo se naÄÃ­st meta.json pro kontrolu verze.');
        });
    }, 30000);
}

// APP START
document.addEventListener('DOMContentLoaded', () => {
    progressBar();
    initApp();
});

const progressBar = () => {
  var bar = "_" + Date.now();
  document.getElementsByTagName("body")[0].insertAdjacentHTML(
    'beforeend', '<div class="progress-container"><div class="progress-bar" id="' + bar + '" style="width: 0%"></div></div>'
  );
  window.ontouchmove = onscroll;
  window.onscroll = onscroll;

  function onscroll() {
    var scroll = document.body.scrollTop || document.documentElement.scrollTop;
    var height = document.documentElement.scrollHeight - document.documentElement.clientHeight;
    var scrolled = Math.round(scroll * 100 / height);
    if (document.getElementById(bar)) document.getElementById(bar).style.width = scrolled + '%';
  };
}

const initApp = () => {
    const dataFile = './data.json'; 
    console.time('JSON-Fetch');
    
    fetch(dataFile)
        .then(response => {
            if (!response.ok) throw new Error('data.json nebyl nalezen');
            return response.json();
        })
        .then(data => {
            console.timeEnd('JSON-Fetch');
            if (!data) {
                debug('Chyba: Å½Ã¡dnÃ¡ data nepÅ™iÅ¡la');
                return;
            }
            let goods = [];
            if (data && data.goods && Array.isArray(data.goods)) {
                goods = data.goods;
            }
            if (goods.length === 0) {
                debug('VarovÃ¡nÃ­: Å½Ã¡dnÃ© zboÅ¾Ã­ k renderovÃ¡nÃ­!');
                console.error('Struktura dat neodpovÃ­dÃ¡: ', data);
                return;
            }

            // save data
            deals.goods = goods;
            deals.markets = data.markets;
            deals.cats = '.c-ZELENINA, .c-OVOCE, .c-OÅ˜ECHY';

            $('#stats').html(`Slev celkem: <b>${goods.length}</b>
                <br>ObchodÅ¯ celkem: <b>${data.markets.length}</b>
                <br>Datum sestavenÃ­: <b>${data.created}</b>`);
            $('#deals').html('').addClass('hidden');

            console.time('DOM-Render-Speed');
            renderDeals(goods);
            renderMarkets(deals.markets);
            console.timeEnd('DOM-Render-Speed');
            
            // defaults
            $('#deals article').addClass('hidden-force');
            $('.c-ZELENINA, .c-OVOCE, .c-OÅ˜ECHY').removeClass('hidden-force');
            $('#deals').removeClass('hidden');

            checkUpdate();
            setTimeout(() => {$('#loading').addClass('fade-away');}, 500);
            window.scrollTo({top: 0});
        })
        .catch(error => {
            console.error('Chyba pÅ™i stress-testu:', error);
            debug('Chyba staÅ¾enÃ­ dat: ' + error.message);
        });
};

// RENDERERs
const renderDeals = (deals) => {
    const dealsGrid = document.getElementById('deals');
    if (!dealsGrid) return;
    dealsGrid.innerHTML = deals.map(deal => `
        <article class="product-card c-${deal.cat}" data-id="${deal.id}" data-cat="${deal.cat}" data-query="${deal.query}" data-name="${deal.name}" data-market="${deal.store}">
            <img src="/markets/${deal.market}.webp" loading="lazy" alt="${deal.store}" class="notap market-image">
            <div class="product-image-container">
                <div class="image-wrapper">
                    <img src="/images/${deal.image}" loading="lazy" alt="${deal.name}" title="${deal.name}" class="notap product-image">
                </div>
            </div>
            <div class="product-name bold" title="${deal.name}">${deal.name}</div>
            <div class="product-note" title="${deal.note}">${deal.note}</div>
            <div class="product-price">
                <span class="discount mono">${deal.discount}</span>
                <span class="price">${deal.price} <span class="volume">(${deal.volume})</span></span>
                <span class="ppunit">${deal.priceperunit}</span>
            </div>
            <div class="validity nowrap bold">${deal.validity}</div>
        </article>
    `).join('');
};

const renderMarkets = (markets) => {
    if (!markets) return;
    const marketsDiv = document.getElementById('mymarkets');
    if (!marketsDiv) return;

    // PÅ™idÃ¡me "VÅ¡e" jako prvnÃ­ volbu, pokud ji v poli uÅ¾ nemÃ¡Å¡
    marketsDiv.innerHTML = markets.map(market => `
        <button class="chip outline secondary" disabled data-market="${market}">
            <i>store</i>
            <span>${market}</span>
        </button>
    `).join('');

    $('#mymarkets button').on('click', function() {
        const selectedMarket = $(this).data('market');
        $('#mymarkets button').removeClass('fill').addClass('outline');
        $(this).removeClass('outline').addClass('fill');
    });
};

// UI bindings
$(document).ready(function() {
    // bool: is flash animation pending?
    var flash_flag = false;

    // bool: is face animation pending?
    var face_flag = false;

    // TBD: keyboard events
    window.onkeydown = function(e) {
        //debug('key: '+ e.key);
    }

    // SAVE button
    $('#save').on('click', function() {
        exportSettings();
    });

    // ABOUT button
    $('.about-btn').on('click', function() {
        window.scrollTo({top: 0});
        const isVisible = $('#about').is(':visible');
        $('#about, #settings, #deals').hide();
        if (isVisible) {
            $('#deals').show();
        } else {
            $('#about').show();
        }
    });

    // SETTINGS button
    $('.settings-btn').on('click', function() {
        window.scrollTo({top: 0});
        const isVisible = $('#settings').is(':visible');
        $('#about, #settings, #deals').hide();
        if (isVisible) {
            $('#deals').show();
        } else {
            $('#settings').show();
        }
    });

    // Mr. Smiley emoji animation
    let currentFaceIsYummy = false;
    $('.billionaire').on('click', function() {
        if (face_flag) return;
        face_flag = true;
        currentFaceIsYummy = !currentFaceIsYummy;
        const newface = currentFaceIsYummy ? 'ğŸ˜‹' : 'ğŸ¤‘';
        const $face = $('.dollarface');
        $face.removeClass('facespinner');
        void $face[0].offsetWidth;
        $face.addClass('facespinner');
        setTimeout(() => {
            $face.text(newface);
        }, 200);
        setTimeout(() => {
            $face.removeClass('facespinner');
            face_flag = false;
        }, 1200);
        setTimeout(() => {
            $('#deals').html('').addClass('hidden');
            let goods = deals.goods;        
            goods.shuffle();
            renderDeals(goods);
            $('#deals article').addClass('hidden-force');
            $(deals.cats).removeClass('hidden-force');
            $('#settings, #about').hide()
            $('#deals').show();
            $('#deals').removeClass('hidden');
        }, 400);
        window.scrollTo({top: 0, behavior: 'smooth'});
    });

    // handedness button
    $('.settings-button').on('click', function() {
        switchHands();
    });

    // switch handedness
    function switchHands() {
        if (flash_flag) return;
        flash_flag = true;
        $('nav').addClass('flashbomb');
        $('.lefthanded').toggle();
        $('.righthanded').toggle();
        const currentMode = $('.lefthanded').is(':visible') ? 'left' : 'right';
        setTimeout(() => {$('nav').removeClass('flashbomb');flash_flag = false;}, 500);
        if (window.nolocalstorage) return;
        localStorage.setItem('handedness', currentMode);
    }

    // process handedness from localStorage
    if (!window.nolocalstorage) {
        const savedHandedness = localStorage.getItem('handedness');
        if (savedHandedness === 'left') {
            $('.lefthanded').show();
            $('.righthanded').hide();
        } else if (savedHandedness === 'right') {
            $('.lefthanded').hide();
            $('.righthanded').show();
        }
    }

    // export settings
    function exportSettings() {
        const data = {
            // Pokud je handedness null, uloÅ¾Ã­me default 'right'
            handedness: localStorage.getItem('handedness') || 'right',
            myCats: deals.myCats || [],
            myMarkets: deals.myMarkets || [],
            blocked: deals.blocked || [],
            likes: deals.likes || [],
            version: version,
            git_build_date: git_build_date,
            git_revisions: git_revisions
        };
        
        const jsonString = JSON.stringify(data, null, 2);
        const blob = new Blob([jsonString], {type: 'application/json'});
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        
        a.href = url;
        a.download = 'slevicky_settings.json';
        
        // NutnÃ© pro Firefox a stabilitu:
        document.body.appendChild(a); 
        a.click();

        // clean up - odstranÃ­ element i uvolnÃ­ URL z pamÄ›ti
        setTimeout(() => {
            document.body.removeChild(a);
            window.URL.revokeObjectURL(url);
        }, 0);
    }

    // refresh button
    $('.refresh-btn').on('click', function() {
        $(this).prop('disabled', true).html('<i>schedule</i>');
        if ('serviceWorker' in navigator && navigator.serviceWorker.controller) {
            navigator.serviceWorker.controller.postMessage({type: 'SKIP_WAITING'});
        }
        const buster = Math.random().toString(36).substring(2, 6);
        location.href = '/?' + buster;
    });

    // debugger close
    $('#debugger').on('click', function() {
        dtimer = null;
        $('#debugger').fadeOut(function() {
            $('#debugger').html('').removeClass('debugger-on');
        });
    });

    // BOTTOM NAVIGATION
    $('.btn-bottom').on('click', function() {
        const cats = $(this).data('cats');
        if (!cats) return;
        deals.cats = cats;
        $('nav.bottom button').addClass('grayscaled');
        const myClass = $(this).attr('class').split(' ').find(c => c.startsWith('but'));
        $('.' + myClass).removeClass('grayscaled');
        $('#deals article').addClass('hidden-force');        
        $(cats).removeClass('hidden-force');
        $('#settings, #about').hide()
        $('#deals').show()
        window.scrollTo({top: 0});
    });

    // defaults
    $('nav.bottom button').addClass('grayscaled');
    $('.but1').removeClass('grayscaled');

    // context event hanlder
    window.handleContextEvent = function(e) {
        const card = e.target.closest('.product-card');
        if (card) {
            const productName = card.querySelector('.product-name')?.innerText;
            debug('produkt: ' + productName);
            $(card).addClass('flashbomb');
            setTimeout(() => {$(card).removeClass('flashbomb');}, 200);
            return false;
        }
        // data-id
        const elementWithId = e.target.closest('[data-id]');
        if (elementWithId) {
            const id = elementWithId.getAttribute('data-id');
            debug('data-id: ' + id);
            return false;
        }
        // fallback
        const info = e.target.title || e.target.id || e.target.tagName;
        debug('Target: ' + info);
        return false;
    }
});

// SERVICE WORKER
if ('serviceWorker' in navigator) {
    window.addEventListener('load', () => {
        navigator.serviceWorker.register('/sw.js')
            .then(registration => {
                console.log('ServiceWorker registration successful with scope: ', registration.scope);
            }, err => {
                console.log('ServiceWorker registration failed: ', err);
            });
    });
}

// PWA INSTALLER
let deferredPrompt;
window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
    installButtons.forEach(btn => {
        btn.style.display = 'block';
    });
});
const installButtons = document.querySelectorAll('.install-btn');
installButtons.forEach(btn => {
    btn.addEventListener('click', async () => {
        if (deferredPrompt) {
            installButtons.forEach(b => b.style.display = 'none');
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            deferredPrompt = null;
        }
    });
});

// EVENT LISTENERS
window.addEventListener('appinstalled', () => {
    installBtn.style.display = 'none';
    deferredPrompt = null;
});

window.addEventListener('contextmenu', function(e) {
    e.preventDefault();
    e.stopImmediatePropagation();
    window.handleContextEvent(e);
}, true);

window.addEventListener('dblclick', function(e) {
    e.preventDefault();
    e.stopImmediatePropagation();
    window.handleContextEvent(e);
}, true);

document.addEventListener('error', function (e) {
    if (e.target.tagName.toLowerCase() === 'img') {
        const img = e.target;
        img.style.display = 'none';
    }
}, true);

</script>
</body>
</html>