<!DOCTYPE html>
<html lang="cs">
<head>
    <meta charset="UTF-8">
    <title>ü§ë sleviƒçky [{{GIT_REV}}]</title>
    <meta name="theme-color" content="#f5f5f5">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="manifest" href="/manifest.json">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/gh/beercss/beercss@v3.11.33/dist/cdn/beer.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/material-icons@1.13.14/iconfont/material-icons.min.css">
    <style>
        :root {
            --surface-container-low-light: #f5f5f5;
            --surface-container-light: #ececec;
            --surface-container-high-light: #e0e0e0;
            --surface-container-highest-light: #d4d4d4;
            --on-surface-light: #2c2c2c;
            --surface-container-low-dark: #2c2c2c;
            --surface-container-dark: #3a3a3a;
            --surface-container-high-dark: #4b4b4b;
            --surface-container-highest-dark: #5e5e5e;
            --on-surface-dark: #f0f0f0;
        }
        .product-card {
            border-radius: var(--border-radius-2);
            box-shadow: 0 2px 3px rgba(0, 0, 0, 0.1);
            transition: transform 0.2s, box-shadow 0.2s;
            cursor: pointer;
            text-align: center;
            padding-bottom: 1rem;
        }
        .product-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 12px rgba(0, 0, 0, 0.15);
        }
        .product-image {
            width: 100%;
            height: 100px;
            object-fit: cover;
            border-radius: var(--border-radius-2) var(--border-radius-2) 0 0;
        }
        .product-price {
            display: flex;
            justify-content: center;
            align-items: center;
            gap: 4px;
            margin-top: 4px;
        }
        .old-price {
            font-size: 0.8rem;
            text-decoration: line-through;
            color: var(--on-surface-variant);
        }
        .new-price {
            font-size: 1.2rem;
            font-weight: bold;
            color: var(--primary);
        }
        .store-image {
            width: auto;
            height: 48px;
            margin-bottom: 4px;
            border-radius: 3px;
            display: block;
            margin: 0 auto;
        }
    </style>
</head>
<body>
<main class="container">
    <div id="deals-grid" class="grid responsive s1 m2 l4">
    </div>
    <button id="install-btn" class="red fixed top right" style="display:none;">
        <i>download</i>
        <span>Install App</span>
    </button>
</main>
<script>
    document.addEventListener('DOMContentLoaded', () => {
        initApp();
    });

    const initApp = () => {
        // Zde by norm√°lnƒõ prob√≠hal HTTP po≈æadavek na v√°≈° scraping endpoint.
        // Pro √∫ƒçely demonstrace pou≈æ√≠v√°me mock data.
        // P≈ô√≠klad fetch po≈æadavku by mohl vypadat takto:
        // fetch('https://vas-cloudflare-worker.cz/api/deals')
        //     .then(response => response.json())
        //     .then(data => renderDeals(data))
        //     .catch(error => console.error('Chyba p≈ôi naƒç√≠t√°n√≠ dat:', error));
        
        const mockDeals = [
            {
                name: 'K√°va Intenso',
                store: 'albert',
                oldPrice: '129.90',
                newPrice: '89.90',
                image: 'https://placehold.co/400x300/a8dadc/1d3557?text=Kava',
            },
            {
                name: 'Ml√©ko plnotuƒçn√© 1L',
                store: 'billa',
                oldPrice: '25.90',
                newPrice: '19.90',
                image: 'https://placehold.co/400x300/fec89a/2a2a2a?text=Mleko',
            },
            {
                name: 'M√°slo ƒçerstv√© 250g',
                store: 'lidl',
                oldPrice: '45.90',
                newPrice: '32.90',
                image: 'https://placehold.co/400x300/a3b18a/2a2a2a?text=Maslo',
            },
            {
                name: 'Jogurt b√≠l√Ω',
                store: 'kaufland',
                oldPrice: '15.90',
                newPrice: '9.90',
                image: 'https://placehold.co/400x300/e0b1cb/2a2a2a?text=Jogurt',
            },
            {
                name: 'M√°slo ƒçerstv√© 250g',
                store: 'lidl',
                oldPrice: '45.90',
                newPrice: '32.90',
                image: 'https://placehold.co/400x300/a3b18a/2a2a2a?text=Maslo',
            },
            {
                name: 'Jogurt b√≠l√Ω',
                store: 'kaufland',
                oldPrice: '15.90',
                newPrice: '9.90',
                image: 'https://placehold.co/400x300/e0b1cb/2a2a2a?text=Jogurt',
            },
            {
                name: 'P√°rky v akci',
                store: 'tesco',
                oldPrice: '99.90',
                newPrice: '69.90',
                image: 'https://placehold.co/400x300/548235/ffffff?text=Parky',
            },
            {
                name: 'P√°rky v akci',
                store: 'tesco',
                oldPrice: '99.90',
                newPrice: '69.90',
                image: 'https://placehold.co/400x300/548235/ffffff?text=Parky',
            },
            {
                name: 'Chleba ≈†umava',
                store: 'penny',
                oldPrice: '35.90',
                newPrice: '24.90',
                image: 'https://placehold.co/400x300/ffc87d/000000?text=Chleba',
            }
        ];
        renderDeals(mockDeals);
    };

    const renderDeals = (deals) => {
        const dealsGrid = document.getElementById('deals-grid');
        if (!dealsGrid) {
            console.error("Missing deals grid element.");
            return;
        }
        dealsGrid.innerHTML = '';
        deals.forEach(deal => {
            const card = document.createElement('div');
            card.classList.add('card', 'product-card');
            card.innerHTML = `
                <img src="/markets/${deal.store}.webp" alt="${deal.store}" class="store-image">
                <imgx src="${deal.image}" alt="${deal.name}" class="product-image">
                <div class="p-2">
                    <div class="bold">${deal.name}</div>
                    <div class="product-price">
                        <span class="red-text old-price">${deal.oldPrice}</span>
                        <span class="new-price">${deal.newPrice}</span>
                    </div>
                    <div class="chip round bold">detail</div>
                </div>
            `;
            dealsGrid.appendChild(card);
        });
    };

    if ('serviceWorker' in navigator) {
        window.addEventListener('load', () => {
            navigator.serviceWorker.register('/sw.js')
                .then(registration => {
                    console.log('ServiceWorker registration successful with scope: ', registration.scope);
                }, err => {
                    console.log('ServiceWorker registration failed: ', err);
                });
        });
    }

    let deferredPrompt;
    const installBtn = document.getElementById('install-btn');

    window.addEventListener('beforeinstallprompt', (e) => {
        e.preventDefault();
        deferredPrompt = e;
        installBtn.style.display = 'flex';
    });

    installBtn.addEventListener('click', async () => {
        if (deferredPrompt) {
            installBtn.style.display = 'none';
            deferredPrompt.prompt();
            const { outcome } = await deferredPrompt.userChoice;
            console.log(`User response to the install prompt: ${outcome}`);
            deferredPrompt = null;
        }
    });

    window.addEventListener('appinstalled', () => {
        installBtn.style.display = 'none';
        deferredPrompt = null;
    });
</script>
</body>
</html>